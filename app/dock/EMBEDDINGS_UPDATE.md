# Оновлення Embeddings для QA Тесткейсів

Цей документ описує як оновлювати embeddings для тесткейсів, які використовуються для семантичного пошуку.

## Що таке embeddings?

Embeddings - це векторні представлення тексту, які дозволяють знаходити схожі за змістом тесткейси навіть якщо вони використовують різні слова. Наприклад, пошук "login" знайде тесткейси з "авторизація", "вхід в систему", "sign in" тощо.

## Коли потрібно оновлювати embeddings?

- Після додавання нових тесткейсів
- Після зміни існуючих тесткейсів
- Після оновлення моделі embeddings
- Періодично для підтримки актуальності

## Як використовувати скрипт

### Базове використання

```bash
# Показати статистику
./scripts/update_embeddings.sh --stats-only

# Перевірити з'єднання з OpenAI
./scripts/update_embeddings.sh --check-connection

# Dry run (показати що буде зроблено)
./scripts/update_embeddings.sh --dry-run

# Оновити embeddings (за замовчуванням batch_size=50)
./scripts/update_embeddings.sh

# Оновити з кастомним розміром батчу
./scripts/update_embeddings.sh --batch-size 25
```

### Параметри

- `--batch-size, -b` - розмір батчу для обробки (1-100, за замовчуванням 50)
- `--dry-run, -d` - тільки показати що буде зроблено, не виконувати
- `--stats-only, -s` - тільки показати статистику по embeddings
- `--check-connection, -c` - тільки перевірити з'єднання з OpenAI API

### Приклади використання

```bash
# Показати поточний стан
./scripts/update_embeddings.sh -s

# Перевірити чи все працює
./scripts/update_embeddings.sh -c

# Подивитися скільки тесткейсів потрібно оновити
./scripts/update_embeddings.sh -d

# Оновити з меншим батчем (для повільних з'єднань)
./scripts/update_embeddings.sh -b 20

# Оновити з більшим батчем (для швидких з'єднань)
./scripts/update_embeddings.sh -b 100
```

## Що робить скрипт?

1. **Перевіряє з'єднання** з OpenAI API
2. **Показує статистику** по поточному стану embeddings
3. **Знаходить тесткейси** без embeddings
4. **Генерує embeddings** для кожного тесткейса (step + expected_result)
5. **Зберігає в базу даних** оновлені embeddings
6. **Показує результати** операції

## Безпека та продуктивність

- Скрипт використовує rate limiting для OpenAI API
- Обробляє дані батчами для оптимізації
- Показує прогрес виконання
- Можна перервати через Ctrl+C
- Dry run режим для тестування

## Помилки та вирішення

### "Connection failed to OpenAI API"
- Перевірте налаштування `OPENAI_API_KEY` в `.env`
- Перевірте інтернет з'єднання
- Перевірте ліміти API ключа

### "Batch size must be between 1 and 100"
- Використовуйте правильний діапазон для `--batch-size`

### "No testcases without embeddings"
- Всі тесткейси вже мають embeddings, оновлення не потрібне

## Автоматизація

Для регулярного оновлення можна додати в crontab:

```bash
# Оновлювати щодня о 2:00 ранку
0 2 * * * cd /path/to/qa_mcp && ./scripts/update_embeddings.sh
```

## Моніторинг

Скрипт виводить детальну інформацію про:
- Кількість тесткейсів для обробки
- Прогрес виконання
- Час виконання
- Кількість помилок
- Фінальну статистику
