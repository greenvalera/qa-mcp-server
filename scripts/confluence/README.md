# Confluence Integration Module

–¶–µ–π –º–æ–¥—É–ª—å –∑–∞–±–µ–∑–ø–µ—á—É—î —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é –∑ Atlassian Confluence –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó –≤ QA MCP —Å–∏—Å—Ç–µ–º—É.

## ‚ö†Ô∏è –í–ê–ñ–õ–ò–í–ï –ü–û–ü–ï–†–ï–î–ñ–ï–ù–ù–Ø

**Mock API –¥–æ–¥–∞—î —Ñ–µ–π–∫–æ–≤—ñ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –≤ –≤–∞—à—É production –±–∞–∑—É –¥–∞–Ω–∏—Ö!**

- ‚úÖ **–ë–µ–∑–ø–µ—á–Ω–æ**: `--use-real-api` - –ø—Ä–∞—Ü—é—î –∑ —Ä–µ–∞–ª—å–Ω–∏–º Confluence
- ‚ùå **–ù–ï–ë–ï–ó–ü–ï–ß–ù–û**: –ë–µ–∑ —Ñ–ª–∞–≥—É `--use-real-api` - –¥–æ–¥–∞—î —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ

**–ó–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ, —è–∫–∏–π API –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º!**

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
scripts/confluence/
‚îú‚îÄ‚îÄ __init__.py                 # –ü–∞–∫–µ—Ç –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É –º–æ–¥—É–ª—ñ–≤
‚îú‚îÄ‚îÄ confluence_loader.py        # –ì–æ–ª–æ–≤–Ω–∏–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
‚îú‚îÄ‚îÄ confluence_mock.py          # Mock API –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —Ä–æ–∑—Ä–æ–±–∫–∏
‚îú‚îÄ‚îÄ confluence_real.py          # –†–µ–∞–ª—å–Ω–∏–π Confluence API –∫–ª—ñ—î–Ω—Ç
‚îú‚îÄ‚îÄ load_confluence_data.sh     # Shell —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
‚îî‚îÄ‚îÄ README.md                   # –¶—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
```

## üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

### 1. `unified_loader.py` - **–û–°–ù–û–í–ù–ò–ô –ó–ê–í–ê–ù–¢–ê–ñ–£–í–ê–ß** ‚≠ê

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –û–±'—î–¥–Ω–∞–Ω–∏–π –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—á –¥–ª—è MySQL —Ç–∞ –≤–µ–∫—Ç–æ—Ä–Ω–æ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.

**–û—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó**:
- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–æ–∫ –∑ Confluence (—á–µ—Ä–µ–∑ mock –∞–±–æ —Ä–µ–∞–ª—å–Ω–∏–π API)
- **MySQL**: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏—Ö QA –æ–±'—î–∫—Ç—ñ–≤ (QASection, Checklist, TestCase, Config)
- **Vector DB**: –†–æ–∑–±–∏—Ç—Ç—è —Ç–µ–∫—Å—Ç—É –Ω–∞ —á–∞–Ω–∫–∏, –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è embeddings, –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ Qdrant
- AI –∞–Ω–∞–ª—ñ–∑ –∫–æ–Ω—Ç–µ–Ω—Ç—É —á–µ—Ä–µ–∑ QAContentAnalyzer
- –î–µ—Ç–∞–ª—å–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—É —Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —á–∞—Å—Ç–∫–æ–≤–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è (—Ç—ñ–ª—å–∫–∏ MySQL –∞–±–æ —Ç—ñ–ª—å–∫–∏ Vector DB)

### 2. `confluence_loader.py` - –ó–∞—Å—Ç–∞—Ä—ñ–ª–∏–π –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—á

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –°—Ç–∞—Ä–∏–π –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—á —Ç—ñ–ª—å–∫–∏ –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ—ó –±–∞–∑–∏ (–∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π).

**‚ö†Ô∏è –£–í–ê–ì–ê**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `unified_loader.py` –∑–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ —Ñ–∞–π–ª—É!

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**:
```bash
# ‚≠ê –†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–ò–ô –°–ü–û–°–Ü–ë - –û–±'—î–¥–Ω–∞–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
python3 scripts/confluence/unified_loader.py --use-real-api --use-config

# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ mock API (–¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)
python3 scripts/confluence/unified_loader.py --limit 5

# –¢—ñ–ª—å–∫–∏ MySQL (–±–µ–∑ –≤–µ–∫—Ç–æ—Ä–Ω–æ—ó –±–∞–∑–∏)
python3 scripts/confluence/unified_loader.py --use-real-api --use-config --mysql-only

# –¢—ñ–ª—å–∫–∏ –≤–µ–∫—Ç–æ—Ä–Ω–∞ –±–∞–∑–∞ (–±–µ–∑ MySQL)
python3 scripts/confluence/unified_loader.py --use-real-api --use-config --vector-only

# –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω–Ω—è
python3 scripts/confluence/unified_loader.py --use-real-api --test-connection
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞**:
- `--page-ids` - –°–ø–∏—Å–æ–∫ root page IDs (—á–µ—Ä–µ–∑ –∫–æ–º—É)
- `--spaces` - –°–ø–∏—Å–æ–∫ –ø—Ä–æ—Å—Ç–æ—Ä—ñ–≤ Confluence (—á–µ—Ä–µ–∑ –∫–æ–º—É)
- `--labels` - –§—ñ–ª—å—Ç—Ä –ø–æ –ª–µ–π–±–ª–∞—Ö
- `--since` - –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏, –æ–Ω–æ–≤–ª–µ–Ω—ñ –ø—ñ—Å–ª—è –¥–∞—Ç–∏ (ISO —Ñ–æ—Ä–º–∞—Ç)
- `--limit` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —á–µ–∫–ª—ñ—Å—Ç—ñ–≤ –¥–ª—è –æ–±—Ä–æ–±–∫–∏
- `--use-config` - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ page IDs –∑ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó (.env)
- `--use-real-api` - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä–µ–∞–ª—å–Ω–∏–π Confluence API
- `--test-connection` - –¢–µ—Å—Ç—É–≤–∞—Ç–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ Confluence
- `--mysql-only` - –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –≤ MySQL (–ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –≤–µ–∫—Ç–æ—Ä–Ω—É –±–∞–∑—É)
- `--vector-only` - –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É –±–∞–∑—É (–ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ MySQL)

### 2. `confluence_mock.py` - Mock API

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –°–∏–º—É–ª—è—Ü—ñ—è Confluence API –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏ —Ç–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –±–µ–∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ Confluence.

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ**:
- –ì–µ–Ω–µ—Ä—É—î —Ñ–µ–π–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- –Ü–º—ñ—Ç—É—î API –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
- –î–æ–∑–≤–æ–ª—è—î —Ä–æ–∑—Ä–æ–±–ª—è—Ç–∏ –±–µ–∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Confluence
- –í–∫–ª—é—á–∞—î –ø—Ä–∏–∫–ª–∞–¥–∏ QA —á–µ–∫–ª—ñ—Å—Ç—ñ–≤, API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó, –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤

**–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ** –∫–æ–ª–∏ `--use-real-api` –Ω–µ –≤–∫–∞–∑–∞–Ω–æ.

### 3. `confluence_real.py` - –†–µ–∞–ª—å–Ω–∏–π Confluence API

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –ö–ª—ñ—î–Ω—Ç –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ä–µ–∞–ª—å–Ω–∏–º Confluence API —á–µ—Ä–µ–∑ atlassian-python-api.

**–§—É–Ω–∫—Ü—ñ—ó**:
- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ Confluence
- –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–æ–∫, –ø—Ä–æ—Å—Ç–æ—Ä—ñ–≤, –ª–µ–π–±–ª—ñ–≤
- –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è Confluence storage format –¥–æ plain text
- –û–±—Ä–æ–±–∫–∞ HTML —Ç–∞ –º–∞–∫—Ä–æ—Å—ñ–≤ Confluence
- –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω–Ω—è

**–í–∏–º–æ–≥–∏**:
- –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π `.env` —Ñ–∞–π–ª –∑ Confluence credentials
- –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π `atlassian-python-api` –ø–∞–∫–µ—Ç

### 4. `load_confluence_data.sh` - Shell —Å–∫—Ä–∏–ø—Ç

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –ó—Ä—É—á–Ω–∏–π —Å–ø–æ—Å—ñ–± –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –∑ `.env` —Ñ–∞–π–ª—É.

**–§—É–Ω–∫—Ü—ñ—ó**:
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å `.env` —Ñ–∞–π–ª—É
- –í—ñ–¥–æ–±—Ä–∞–∂–∞—î –ø–æ—Ç–æ—á–Ω—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
- –í–∞–ª—ñ–¥—É—î –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
- –ó–∞–ø—É—Å–∫–∞—î confluence_loader –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**:
```bash
# –ó –∫–æ—Ä–µ–Ω–µ–≤–æ—ó –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –ø—Ä–æ–µ–∫—Ç—É
./scripts/confluence/load_confluence_data.sh
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (.env —Ñ–∞–π–ª)

```bash
# Confluence –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
CONFLUENCE_BASE_URL=https://your-domain.atlassian.net
CONFLUENCE_AUTH_TOKEN=your_auth_token
CONFLUENCE_SPACE_KEY=QA
CONFLUENCE_ROOT_PAGES=123456789,987654321

# OpenAI –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
OPENAI_API_KEY=your_openai_api_key
OPENAI_MODEL=gpt-4o-mini

# Vector DB –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
VECTORDB_URL=http://localhost:6333
```

### –û—Ç—Ä–∏–º–∞–Ω–Ω—è Confluence Auth Token

1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ [Atlassian Account Settings](https://id.atlassian.com/manage-profile/security/api-tokens)
2. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π API token
3. –î–æ–¥–∞–π—Ç–µ –π–æ–≥–æ –≤ `.env` —Ñ–∞–π–ª —è–∫ `CONFLUENCE_AUTH_TOKEN`

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### 1. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ Mock API

‚ö†Ô∏è **–í–ê–ñ–õ–ò–í–û**: Mock API –¥–æ–¥–∞—î —Ñ–µ–π–∫–æ–≤—ñ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –≤ –≤–∞—à—É –≤–µ–∫—Ç–æ—Ä–Ω—É –±–∞–∑—É –¥–∞–Ω–∏—Ö!

```bash
# –ê–∫—Ç–∏–≤–∞—Ü—ñ—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
source venv/bin/activate

# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö (–î–û–î–ê–Ñ –§–ï–ô–ö–û–í–Ü –î–ê–ù–Ü!)
python3 -m scripts.confluence.confluence_loader --once
```

**–£–≤–∞–≥–∞**: –¶—è –∫–æ–º–∞–Ω–¥–∞ –¥–æ–¥–∞—Å—Ç—å 6 —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –≤ Qdrant. –î–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ:

```bash
# –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –∑ Qdrant
curl -X POST "http://localhost:6333/collections/qa_chunks/points/delete" \
  -H "Content-Type: application/json" \
  -d '{"filter": {"must": [{"key": "confluence_page_id", "match": {"any": ["123456789", "123456790", "123456791", "234567890", "234567891", "345678901"]}}]}}'
```

### 2. –†–æ–±–æ—Ç–∞ –∑ —Ä–µ–∞–ª—å–Ω–∏–º Confluence

```bash
# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è .env —Ñ–∞–π–ª—É
cp env.example .env
# –í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ .env –∑ –≤–∞—à–∏–º–∏ Confluence credentials

# –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω–Ω—è
python3 scripts/confluence/unified_loader.py --use-real-api --test-connection

# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö (–ó–ê–í–ñ–î–ò –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ --use-real-api!)
./scripts/confluence/load_confluence_data.sh
```

‚ö†Ô∏è **–í–ê–ñ–õ–ò–í–û**: –ó–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ñ–ª–∞–≥ `--use-real-api` –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏!

### 3. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –¥–∞–Ω–∏—Ö

```bash
# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –ø—Ä–æ—Å—Ç–æ—Ä—ñ–≤
python3 scripts/confluence/unified_loader.py \
  --use-real-api \
  --spaces "QA,ENG,DOC"

# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–æ–∫ –∑ –¥–æ—á—ñ—Ä–Ω—ñ–º–∏
python3 scripts/confluence/unified_loader.py \
  --use-real-api \
  --page-ids "123456789,987654321"

# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤, –æ–Ω–æ–≤–ª–µ–Ω–∏—Ö –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ–π —Ç–∏–∂–¥–µ–Ω—å
python3 scripts/confluence/unified_loader.py \
  --use-real-api \
  --since "2024-01-01T00:00:00"

# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ –ª—ñ–º—ñ—Ç–æ–º –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
python3 scripts/confluence/unified_loader.py \
  --use-real-api \
  --use-config \
  --limit 10
```

## üìä –ü—Ä–æ—Ü–µ—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

### MySQL (—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ QA –¥–∞–Ω—ñ):
1. **–û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–æ–∫** - –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ Confluence API –∞–±–æ mock
2. **AI –∞–Ω–∞–ª—ñ–∑ –∫–æ–Ω—Ç–µ–Ω—Ç—É** - QAContentAnalyzer –∞–Ω–∞–ª—ñ–∑—É—î –∫–æ–Ω—Ç–µ–Ω—Ç
3. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è QA –æ–±'—î–∫—Ç—ñ–≤** - QASection, Checklist, TestCase, Config
4. **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ MySQL** - –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è QA –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç—É

### Vector DB (–≤–µ–∫—Ç–æ—Ä–Ω–∏–π –ø–æ—à—É–∫):
1. **–ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ç–µ–Ω—Ç—É** - –í–∏–¥–∞–ª–µ–Ω–Ω—è HTML, –º–∞–∫—Ä–æ—Å—ñ–≤, —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è
2. **Chunking** - –†–æ–∑–±–∏—Ç—Ç—è —Ç–µ–∫—Å—Ç—É –Ω–∞ —á–∞—Å—Ç–∏–Ω–∏ –∑ –ø–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è–º
3. **Embeddings** - –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –≤–µ–∫—Ç–æ—Ä–Ω–∏—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—å —á–µ—Ä–µ–∑ OpenAI
4. **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ Qdrant** - –í–µ–∫—Ç–æ—Ä–Ω–∞ –±–∞–∑–∞ –¥–ª—è AI-–ø–æ—à—É–∫—É

## üîç –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

```bash
# –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
curl -X GET "http://localhost:6333/collections/qa_chunks" | jq '.result.points_count'

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
curl -X POST "http://localhost:6333/collections/qa_chunks/points/scroll" \
  -H "Content-Type: application/json" \
  -d '{
    "filter": {
      "must": [
        {
          "key": "confluence_page_id",
          "match": {
            "any": ["123456789", "123456790", "123456791", "234567890", "234567891", "345678901"]
          }
        }
      ]
    },
    "limit": 10
  }' | jq '.result.points | length'
# –ú–∞—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ 0 –¥–ª—è —á–∏—Å—Ç–æ—ó –±–∞–∑–∏

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
curl -X POST "http://localhost:6333/collections/qa_chunks/points/scroll" \
  -H "Content-Type: application/json" \
  -d '{"limit": 5, "with_payload": true}' | jq '.result.points[] | {title: .payload.title, space: .payload.space, page_id: .payload.confluence_page_id}'
```

### –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—É

–°–∫—Ä–∏–ø—Ç –Ω–∞–¥–∞—î –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø—Ä–æ—Ü–µ—Å:
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–Ω–∞–π–¥–µ–Ω–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–æ–∫
- –ü—Ä–æ–≥—Ä–µ—Å –æ–±—Ä–æ–±–∫–∏ –∫–æ–∂–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö —á–∞–Ω–∫—ñ–≤
- –ü–æ–º–∏–ª–∫–∏ —Ç–∞ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è

## üõ†Ô∏è –†–æ–∑—Ä–æ–±–∫–∞ —Ç–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### ‚ö†Ô∏è –ë–µ–∑–ø–µ–∫–∞ –¥–∞–Ω–∏—Ö —Ç–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**–ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–õ–ò–í–û**: Mock API –¥–æ–¥–∞—î —Ñ–µ–π–∫–æ–≤—ñ –¥–∞–Ω—ñ –≤ production –±–∞–∑—É –¥–∞–Ω–∏—Ö!

#### –ë–µ–∑–ø–µ—á–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

1. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—É —Ç–µ—Å—Ç–æ–≤—É –±–∞–∑—É**:
```bash
# –°—Ç–≤–æ—Ä—ñ—Ç—å –æ–∫—Ä–µ–º—É –∫–æ–ª–µ–∫—Ü—ñ—é –¥–ª—è —Ç–µ—Å—Ç—ñ–≤
curl -X PUT "http://localhost:6333/collections/qa_chunks_test" \
  -H "Content-Type: application/json" \
  -d '{"vectors": {"size": 1536, "distance": "Cosine"}}'
```

2. **–¢–µ—Å—Ç—É–π—Ç–µ —ñ–º–ø–æ—Ä—Ç–∏ –±–µ–∑ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è**:
```bash
# –¢–µ—Å—Ç –±–µ–∑ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –±–∞–∑—É (–¥–æ–¥–∞–π—Ç–µ --dry-run —Ñ–ª–∞–≥)
python3 -c "
from scripts.confluence import MockConfluenceAPI
api = MockConfluenceAPI()
pages = api.get_pages()
print(f'‚úì Mock API: {len(pages)} —Å—Ç–æ—Ä—ñ–Ω–æ–∫')
for page in pages[:2]:
    print(f'  - {page[\"title\"]}')
"
```

3. **–ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –≤–º—ñ—Å—Ç –±–∞–∑–∏ –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è–º**:
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
curl -X GET "http://localhost:6333/collections/qa_chunks" | jq '.result.points_count'

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
curl -X POST "http://localhost:6333/collections/qa_chunks/points/scroll" \
  -H "Content-Type: application/json" \
  -d '{"limit": 5, "with_payload": true}' | jq '.result.points[] | .payload.title'
```

#### –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö

–Ø–∫—â–æ –≤–∏ –≤–∏–ø–∞–¥–∫–æ–≤–æ –¥–æ–¥–∞–ª–∏ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ:

```bash
# –í–∏–¥–∞–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö –º–æ–∫–Ω—É—Ç–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
curl -X POST "http://localhost:6333/collections/qa_chunks/points/delete" \
  -H "Content-Type: application/json" \
  -d '{
    "filter": {
      "must": [
        {
          "key": "confluence_page_id",
          "match": {
            "any": ["123456789", "123456790", "123456791", "234567890", "234567891", "345678901"]
          }
        }
      ]
    }
  }'
```

#### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ—Å–ª—è –æ—á–∏—â–µ–Ω–Ω—è

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –≤–∏–¥–∞–ª–µ–Ω—ñ
curl -X POST "http://localhost:6333/collections/qa_chunks/points/scroll" \
  -H "Content-Type: application/json" \
  -d '{
    "filter": {
      "must": [
        {
          "key": "confluence_page_id",
          "match": {
            "any": ["123456789", "123456790", "123456791", "234567890", "234567891", "345678901"]
          }
        }
      ]
    },
    "limit": 10
  }' | jq '.result.points | length'
# –ú–∞—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ 0
```

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π

1. **Mock API**: –î–æ–¥–∞–π—Ç–µ –Ω–æ–≤—ñ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –≤ `confluence_mock.py`
2. **Real API**: –†–æ–∑—à–∏—Ä—Ç–µ –º–µ—Ç–æ–¥–∏ –≤ `confluence_real.py`
3. **Loader**: –û–Ω–æ–≤—ñ—Ç—å –ª–æ–≥—ñ–∫—É –≤ `confluence_loader.py`

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

```bash
# –¢–µ—Å—Ç —ñ–º–ø–æ—Ä—Ç—ñ–≤
python3 -c "from scripts.confluence import ConfluenceLoader, MockConfluenceAPI, RealConfluenceAPI; print('‚úì –Ü–º–ø–æ—Ä—Ç–∏ –ø—Ä–∞—Ü—é—é—Ç—å')"

# –¢–µ—Å—Ç mock API (–±–µ–∑ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è)
python3 -c "from scripts.confluence import MockConfluenceAPI; api = MockConfluenceAPI(); print(f'‚úì Mock API: {len(api.get_pages())} —Å—Ç–æ—Ä—ñ–Ω–æ–∫')"
```

## üêõ –£—Å—É–Ω–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∏ –∑ —Ç–µ—Å—Ç–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏

**–°–∏–º–ø—Ç–æ–º**: –í –±–∞–∑—ñ –¥–∞–Ω–∏—Ö –∑'—è–≤–∏–ª–∏—Å—è —Ñ–µ–π–∫–æ–≤—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∑ —Ç–∞–∫–∏–º–∏ –Ω–∞–∑–≤–∞–º–∏:
- "Authentication Testing Checklist"
- "API Testing Guidelines" 
- "UI Testing Procedures"
- "Authentication Service Architecture"
- "Deployment Pipeline Documentation"
- "API Documentation Standards"

**–ü—Ä–∏—á–∏–Ω–∞**: –ó–∞–ø—É—Å–∫ confluence_loader –±–µ–∑ —Ñ–ª–∞–≥—É `--use-real-api` –¥–æ–¥–∞—î –º–æ–∫–Ω—É—Ç—ñ –¥–∞–Ω—ñ.

**–†—ñ—à–µ–Ω–Ω—è**:
```bash
# 1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
curl -X GET "http://localhost:6333/collections/qa_chunks" | jq '.result.points_count'

# 2. –í–∏–¥–∞–ª—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏
curl -X POST "http://localhost:6333/collections/qa_chunks/points/delete" \
  -H "Content-Type: application/json" \
  -d '{"filter": {"must": [{"key": "confluence_page_id", "match": {"any": ["123456789", "123456790", "123456791", "234567890", "234567891", "345678901"]}}]}}'

# 3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø—Ä–æ–π—à–ª–æ —É—Å–ø—ñ—à–Ω–æ
curl -X GET "http://localhost:6333/collections/qa_chunks" | jq '.result.points_count'
```

### –ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ Confluence
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `CONFLUENCE_BASE_URL` —Ç–∞ `CONFLUENCE_AUTH_TOKEN`
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —Ç–æ–∫–µ–Ω –º–∞—î –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –ø—Ä–æ—Å—Ç–æ—Ä—ñ–≤
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ `--test-connection` –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –ü–æ–º–∏–ª–∫–∏ –∑ OpenAI API
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `OPENAI_API_KEY`
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —É –≤–∞—Å —î –∫—Ä–µ–¥–∏—Ç–∏ –Ω–∞ API

### –ü–æ–º–∏–ª–∫–∏ –∑ –≤–µ–∫—Ç–æ—Ä–Ω–æ—é –±–∞–∑–æ—é
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ Qdrant –∑–∞–ø—É—â–µ–Ω–∏–π
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `VECTORDB_URL` –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

## üìù –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –Ü–º–ø–æ—Ä—Ç –≤ Python –∫–æ–¥—ñ

```python
from scripts.confluence import ConfluenceLoader, MockConfluenceAPI

# –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è mock API
loader = ConfluenceLoader(use_mock=True)
result = await loader.load_pages(space_keys=["QA"], once=True)

# –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ API
loader = ConfluenceLoader(use_mock=False)
result = await loader.load_pages(
    space_keys=["QA", "ENG"],
    labels=["checklist", "guide"],
    once=True
)
```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

```bash
# Cron job –¥–ª—è —â–æ–¥–µ–Ω–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
0 2 * * * cd /path/to/qa_mcp && ./scripts/confluence/load_confluence_data.sh
```

## üîó –ü–æ–≤'—è–∑–∞–Ω—ñ –º–æ–¥—É–ª—ñ

- `app/data/vectordb_repo.py` - –†–æ–±–æ—Ç–∞ –∑ –≤–µ–∫—Ç–æ—Ä–Ω–æ—é –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö
- `app/ai/embedder.py` - –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è embeddings
- `app/config.py` - –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏
- `app/mcp_tools.py` - MCP —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –¥–ª—è –ø–æ—à—É–∫—É
